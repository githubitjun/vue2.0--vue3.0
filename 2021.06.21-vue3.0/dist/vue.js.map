{"version":3,"file":"vue.js","sources":["../src/reactivity/computed.ts","../src/share/index.ts","../src/reactivity/effect.ts","../src/reactivity/baseHandlers.ts","../src/reactivity/reactive.ts","../src/reactivity/ref.ts"],"sourcesContent":["export function computed(){\r\n    \r\n}","\r\nexport const isObject = (value)=> typeof value === 'object' && value !== null;\r\n\r\nexport const isSymbol = (value) => typeof value === 'symbol'\r\n\r\nexport const isArray = Array.isArray;\r\nexport const isInteger = (key) => \"\" + parseInt(key,10) === key;\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\r\n\r\nexport const hasOwn = (val,key) => hasOwnProperty.call(val,key);\r\n\r\nexport const hasChanged = (value,oldValue) => value !== oldValue;","import { isArray, isInteger } from \"../share/index\";\r\n\r\nexport function effect(fn,options:any={}){ //effect => vue2 中的watch\r\n    const effect = createReactiveEffect(fn,options);\r\n    if (!options.lazy) {\r\n        effect()\r\n    }\r\n    return effect;\r\n}\r\n\r\n\r\nlet activeEffect; // 用来存储当前的 effect 函数\r\n\r\nlet uid= 0;\r\nconst effectStack = []\r\nfunction createReactiveEffect(fn,options){\r\n    const effect = function(){\r\n        if (!effectStack.includes(effect)) { // 防止递归执行\r\n            try {\r\n                activeEffect = effect\r\n                effectStack.push(activeEffect);\r\n                return fn()//用户自己写的逻辑,内部会对数据进行取值操作,在取值的时候 可以拿到 activeEffect 函数\r\n            }finally {\r\n                effectStack.pop();\r\n                activeEffect = effectStack[effectStack.length-1];\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    effect.id = uid++;\r\n    effect.deps = []; // 用来表示 effect 中依赖了哪些属性\r\n    effect.options = options;\r\n    return effect;\r\n}\r\n\r\n// 将属性和 effect 做一个关联\r\n\r\nconst targetMap = new WeakMap(); // { target:{ key: new Set() } }\r\nexport function track(target,key){\r\n    if (activeEffect == undefined) {\r\n        return;\r\n    }\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        targetMap.set(target,(depsMap = new Map()))\r\n    }\r\n    let dep = depsMap.get(key);\r\n    if (!dep) {\r\n        depsMap.set(key,(dep = new Set)) \r\n    }\r\n    if (!dep.has(activeEffect)) { // 如果没有 effect 就把 effect 放进集合里\r\n        dep.add(activeEffect);\r\n        activeEffect.deps.push(dep); // 双向记忆的过程\r\n    }\r\n    console.log(depsMap);\r\n    \r\n}\r\n\r\nexport function trigger (target,type,key,value?,oldValue?) {\r\n    const depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        return;\r\n    }\r\n    const run = effects => {\r\n        if (effects) {\r\n            effects.forEach(effect => effect())\r\n        }\r\n    }\r\n\r\n    // 数组有特殊情况\r\n    if (key === 'length' && isArray(target)) {\r\n        depsMap.forEach((dep,key)=>{\r\n            if (key == 'length' || key >= value) { // 如果该长度 小于数组原有的长度时,应该更新视图\r\n                run(dep)\r\n            }\r\n        })\r\n    }else {\r\n        // 对象的处理\r\n        if (key != void 0) { // 说明修改了 key\r\n            run(depsMap.get(key))\r\n        }\r\n\r\n        switch (type) {\r\n            case 'add':\r\n                if (isArray(target)) { // 给数组如果通过索引增加选项\r\n                    if(isInteger(key)){\r\n                        run(depsMap.get('length')); //因为如果页面中直接使用了数组也会对数组进行取值操作, 会对length进行收集,\r\n                                                    // 新增属性时直接触发 length;\r\n                    }\r\n                    \r\n                }\r\n                break;\r\n        \r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    \r\n}","import { isSymbol, isObject, isInteger,isArray,hasOwn, hasChanged } from \"../share/index\";\r\n\r\nimport {reactive } from './reactive'\r\nimport { track, trigger } from \"./effect\";\r\n\r\n\r\nfunction createGetter(){\r\n    return function get(target,key,receiver){\r\n        const res = Reflect.get(target,key,receiver); // target[key]\r\n        if (isSymbol(key)) { // 数组中有很多 symbol 的内置方法\r\n            return res;\r\n        }\r\n        track(target,key)\r\n        // 依赖收集\r\n        console.log('此时数据做了获取的操作');\r\n        \r\n        if (isObject(res)) { // 取值是对象再进行递归, 2.0 里面是一上来所有的都递归, 这是懒递归\r\n            return reactive(res)\r\n        }\r\n        return res\r\n    }\r\n}\r\n\r\nfunction createSetter(){\r\n    return function set(target,key,value,receiver){\r\n\r\n        // 新增还是修改?\r\n        const oldValue = target[key];// 如果是修改肯定有老值\r\n        // 看一下有没有这个属性\r\n\r\n        // 第一种是 数组新增的逻辑   第二种是对象的逻辑\r\n        const hadKey = isArray(target) && isInteger(key) ? Number(key) <target.length : hasOwn(target,key)\r\n        \r\n\r\n\r\n\r\n       const result =  Reflect.set(target,key,value,receiver); \r\n\r\n       if (!hadKey) {\r\n           console.log('新增属性');\r\n           trigger(target,'add',key,value)\r\n           \r\n       }else if(hasChanged(value,oldValue)){\r\n           console.log('修改属性');\r\n           trigger(target,'set',key,value,oldValue)\r\n       }\r\n\r\n\r\n       return result;\r\n    }\r\n}\r\n\r\nconst get = createGetter();\r\nconst set = createSetter();\r\n\r\n\r\n\r\nexport const mutableHandlers = {\r\n    get,// 获取对象中的属性会执行此方法\r\n    set,//设置属性值的时候回触发\r\n}","import { isObject } from \"../share/index\";\r\nimport { mutableHandlers } from \"./baseHandlers\";\r\n\r\n\r\n\r\nexport function reactive(target){\r\n    // 我们需要将目标变成响应式的, Proxy\r\n    return creactReactiveObject(target,mutableHandlers); // 核心操作就是当读取文件的时候做依赖收集, 当数据改变时要\r\n    // 重新执行effect \r\n}\r\n\r\n\r\nconst proxyMap = new WeakMap()\r\n\r\nfunction creactReactiveObject(target,baseHandlers){\r\n    // 如果不是对象直接不理     \r\n    if (!isObject(target)) {\r\n        return target\r\n    }\r\n\r\n    const exisitinProxy =proxyMap.get(target);\r\n    if (exisitinProxy) {\r\n        return exisitinProxy\r\n    }\r\n\r\n    // 只是对最外层对象做代理, 默认不会递归, 而且不会重新重写对象中的属性\r\n    const proxy = new Proxy(target,baseHandlers);\r\n    proxyMap.set(target,proxy);// 将代理的对象和 代理后的结果 做一个映射表\r\n    return proxy;\r\n}","export function ref(){\r\n    \r\n}"],"names":[],"mappings":"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"}